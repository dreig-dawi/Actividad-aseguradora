<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad aseguradora</title>
    <style>
        #main {
            display: flex;
            flex-direction: column;
        }

        form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 10px;
        }

        div {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .wrong {
            display: none;
            margin: 0 2px;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            border: 1px solid sandybrown;
            border-radius: 10px;
            padding: 20px;
            width: 200px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .card h3 {
            font-size: 1.2em;
            color: blue;
            margin-bottom: 10px;
        }

        .card p {
            font-size: 1em;
            color: black;
        }

        input[type="text"], input[type="number"], input[type="date"], input[type="file"], select {
            padding: 10px;
            border: 1px solid sandybrown;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        input[type="checkbox"] {
            margin-left: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: blue;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        label {
            font-weight: bold;
        }

        .wrong {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="main">
        <form>
            <div id="nombre_div">
                <label for="nombre">Nombre</label>
                <!-- Limita el campo a 30 caracteres -->
                <input id="nombre" type="text"  placeholder="Nombre" maxlength="30">
            </div>
        
            <div id="apellidos_div">
                <label for="apellidos">Apellidos</label>
                <input id="apellidos" type="text" placeholder="Apellidos">
            </div>
            <div id="DNI_div">
                <label for="DNI">DNI</label>
                <input id="DNI" type="text" placeholder="01234567X">
            </div>
            <div id="correo_div">
                <label for="correo">Correo electrónico</label>
                <input id="correo" type="text" placeholder="abc@def.com">
            </div>
            <div id="telefono_div">
                <label for="telefono">Teléfono</label>
                <input id="telefono" type="number" placeholder="123456789">
            </div>
            <div id="codigo_postal_div">
                <label for="codigo_postal">Código postal</label>
                <input id="codigo_postal" type="number" placeholder="12345">
            </div>
            <div id="carnet_div">
                <label for="carnet">Fecha de expedición del carnet de conducir</label>
                <input id="carnet" type="date">
            </div>
            <div id="matriculacion_div">
                <label for="matriculacion">Fecha de matriculación</label>
                <input id="matriculacion" type="date">
            </div>
            <div id="matricula_div">
                <label for="matricula">Matrícula</label>
                <input id="matricula" type="text" placeholder="1234ABC">
            </div>
            <div id="nacimiento_div">
                <label for="nacimiento">Fecha de nacimiento</label>
                <input id="nacimiento" type="date">
            </div>
            <div id="sexo_div">
                <label for="sexo">Sexo</label>
                <select id="sexo">
                    <option value="hombre">Hombre</option>
                    <option value="mujer">Mujer</option>
                    <option value="otro">Otro</option>
                </select>
            </div>
            <div id="comunidad_provincia_div">
                <label for="comunidad">Comunidad autónoma</label>
                <select id="comunidad">
                    <option value="andalucia">Andalucía</option>
                    <option value="aragon">Aragón</option>
                    <option value="asturias">Asturias</option>
                    <option value="baleares">Baleares</option>
                    <option value="canarias">Canarias</option>
                    <option value="cantabria">Cantabria</option>
                    <option value="castilla_la_mancha">Castilla-La Mancha</option>
                    <option value="castilla_y_leon">Castilla y León</option>
                    <option value="cataluña">Cataluña</option>
                    <option value="comunidad_valenciana">Comunidad Valenciana</option>
                    <option value="extremadura">Extremadura</option>
                    <option value="galicia">Galicia</option>
                    <option value="madrid">Madrid</option>
                    <option value="murcia">Murcia</option>
                    <option value="navarra">Navarra</option>
                    <option value="pais_vasco">País Vasco</option>
                    <option value="la_rioja">La Rioja</option>
                    <option value="ceuta">Ceuta</option>
                    <option value="melilla">Melilla</option>
                </select>
        
                <label for="provincia">Provincia</label>
                <select id="provincia"></select>
            </div>
            <div id="marca_modelo_div">
                <label for="marca">Marca</label>
                <select id="marca">
                    <option value="alfa_romeo">Alfa Romeo</option>
                    <option value="audi">Audi</option>
                    <option value="bmw">BMW</option>
                    <option value="citroen">Citroën</option>
                    <option value="fiat">Fiat</option>
                    <option value="ford">Ford</option>
                    <option value="honda">Honda</option>
                    <option value="hyundai">Hyundai</option>
                    <option value="kia">Kia</option>
                    <option value="mazda">Mazda</option>
                    <option value="mercedes">Mercedes</option>
                    <option value="mini">Mini</option>
                    <option value="nissan">Nissan</option>
                    <option value="opel">Opel</option>
                    <option value="peugeot">Peugeot</option>
                    <option value="renault">Renault</option>
                    <option value="seat">Seat</option>
                    <option value="skoda">Skoda</option>
                    <option value="toyota">Toyota</option>
                    <option value="volkswagen">Volkswagen</option>
                    <option value="volvo">Volvo</option>
                </select>
                <label for="modelo">Modelo</label>
                <select id="modelo"></select>
                <label for="seguro">Tipo de seguro</label>
                <select id="seguro">
                    <option value="terceros">Terceros</option>
                    <option value="terceros_ampliado">Terceros ampliado</option>
                    <option value="franquicia">Con franquicia</option>
                    <option value="todo_riesgo">Todo riesgo</option>
                </select>
            </div>
        
            <div id="vehiculo_div">
                <label for="vehiculo">Tipo de vehículo</label>
                <select id="vehiculo">
                    <option value="diesel">Diesel</option>
                    <option value="gasolina">Gasolina</option>
                    <option value="hibrido">Híbrido</option>
                    <option value="electrico">Eléctrico</option>
                </select>
            </div>
            <div id="archivo_div">
                <label for="archivo">Subir archivo (jpg/jpeg/png)</label>
                <!-- Limita el tipo de archivo a jpg jpeg y png-->
                <input id="archivo" type="file" accept=".jpg,.jpeg,.png">
            </div>
            <img id="archivo_previsualizacion"></img>
            <div id="terminos_div">
                <label for="terminos">Acepto los términos y condiciones</label>
                <input id="terminos" type="checkbox">
            </div>
            <button type="button" onclick="find();">Encontrar seguro</button>
        </form>
    </div>

    <script>
        // Validators
        function validateNombre() {
            const nombre = document.getElementById("nombre");
            if (nombre.value.length < 30) {
                return checkValid(onlyWords(nombre.value), nombre);
            } else {
                invalidInput(nombre);
                return false;
            }
        }

        function validateApellidos() {
            const apellidos = document.getElementById("apellidos");

            return checkValid(onlyWords(apellidos.value), apellidos);
        }

        function validateDNI() {
            const DNI = document.getElementById("DNI");

            // Regex permite 8 números seguidos de una letra
            const DNIRegex = /^[0-9]{8}[a-zA-Z]$/;

            return checkValid(DNIRegex.test(DNI.value), DNI);
        }
           
        function validateNacimiento() {
            const nacimiento = document.getElementById("nacimiento");

            return checkValid(isAdult(nacimiento.value), nacimiento);
        }

        function validateCarnet() {
            const carnet = document.getElementById("carnet");

            return checkValid(isPast(carnet.value), carnet);
        }

        function validateMatriculacion() {
            const matriculacion = document.getElementById("matriculacion");

            return checkValid(isPast(matriculacion.value), matriculacion);
        }

        function validateMatricula() {
            const matricula = document.getElementById("matricula");

            // Regex permite 4 números seguidos de 3 letras
            const matriculaRegex = /^[0-9]{4}[a-zA-Z]{3}$/;

            return checkValid(matriculaRegex.test(matricula.value), matricula);
        }

        function validateCodigoPostal() {
            const codigoPostal = document.getElementById("codigo_postal");

            // Regex permite 5 números
            const codigoPostalRegex = /^[0-9]{5}$/;

            return checkValid(codigoPostalRegex.test(codigoPostal.value), codigoPostal);
        }

        function validateArchivo() {
            const archivo = document.getElementById("archivo");

            // Comprueba que el archivo sea de tipo jpg
            if (checkValid(archivo.value.endsWith(".jpg"), archivo)) {
                const archivoPrevisualizacion = document.getElementById("archivo_previsualizacion");
                const file = archivo.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    archivoPrevisualizacion.src = e.target.result;
                    archivoPrevisualizacion.style.maxWidth = "300px";
                    archivoPrevisualizacion.style.maxHeight = "300px";
                };
                reader.readAsDataURL(file);
                return true;
            } else {
                return false;
            }
        }

        function validateCorreo() {
            const correo = document.getElementById("correo");

            // Regex permite cualquier caracter seguido de @ seguido de cualquier caracter seguido de .
            const correoRegex = /.+@.+\..+/;

            return checkValid(correoRegex.test(correo.value), correo);
        }

        function validateTelefono() {
            const telefono = document.getElementById("telefono");

            // Regex permite 9 números
            const telefonoRegex = /^[0-9]{9}$/;

            return checkValid(telefonoRegex.test(telefono.value), telefono);
        }

        function validateTerminos() {
            const terminos = document.getElementById("terminos");

            return checkValid(terminos.checked, terminos);
        }

        // Event setters
        function setEvents() {
            setValidators();
            setProvinciasList();
            setModelosList();

            document.getElementById("comunidad").addEventListener("change", setProvinciasList);
            document.getElementById("marca").addEventListener("change", setModelosList);
            
            setDragFileEvent();
        }

        function setValidators() {
            document.getElementById("nombre").addEventListener("blur", validateNombre);
            document.getElementById("apellidos").addEventListener("blur", validateApellidos);
            document.getElementById("DNI").addEventListener("blur", validateDNI);
            document.getElementById("nacimiento").addEventListener("input", validateNacimiento);
            document.getElementById("carnet").addEventListener("input", validateCarnet);
            document.getElementById("matriculacion").addEventListener("input", validateMatriculacion);
            document.getElementById("matricula").addEventListener("blur", validateMatricula);
            document.getElementById("codigo_postal").addEventListener("blur", validateCodigoPostal);
            document.getElementById("archivo").addEventListener("change", validateArchivo);

            // Validaciones extra
            document.getElementById("correo").addEventListener("blur", validateCorreo);
            document.getElementById("telefono").addEventListener("blur", validateTelefono);
            document.getElementById("terminos").addEventListener("change", validateTerminos);
        }

        function setProvinciasList() {
            switch (document.getElementById("comunidad").value) {
                case "andalucia":
                    setProvincias(["Almería", "Cádiz", "Córdoba", "Granada", "Huelva", "Jaén", "Málaga", "Sevilla"]);
                    break;
                case "aragon":
                    setProvincias(["Huesca", "Teruel", "Zaragoza"]);
                    break;
                case "asturias":
                    setProvincias(["Asturias"]);
                    break;
                case "baleares":
                    setProvincias(["Baleares"]);
                    break;
                case "canarias":
                    setProvincias(["Las Palmas", "Santa Cruz de Tenerife"]);
                    break;
                case "cantabria":
                    setProvincias(["Cantabria"]);
                    break;
                case "castilla_la_mancha":
                    setProvincias(["Albacete", "Ciudad Real", "Cuenca", "Guadalajara", "Toledo"]);
                    break;
                case "castilla_y_leon":
                    setProvincias(["Ávila", "Burgos", "León", "Palencia", "Salamanca", "Segovia", "Soria", "Valladolid", "Zamora"]);
                    break;
                case "cataluña":
                    setProvincias(["Barcelona", "Girona", "Lleida", "Tarragona"]);
                    break;
                case "comunidad_valenciana":
                    setProvincias(["Alicante", "Castellón", "Valencia"]);
                    break;
                case "extremadura":
                    setProvincias(["Badajoz", "Cáceres"]);
                    break;
                case "galicia":
                    setProvincias(["A Coruña", "Lugo", "Ourense", "Pontevedra"]);
                    break;
                case "madrid":
                    setProvincias(["Madrid"]);
                    break;
                case "murcia":
                    setProvincias(["Murcia"]);
                    break;
                case "navarra":
                    setProvincias(["Navarra"]);
                    break;
                case "pais_vasco":
                    setProvincias(["Álava", "Gipuzkoa", "Bizkaia"]);
                    break;
                case "la_rioja":
                    setProvincias(["La Rioja"]);
                    break;
            }
        }

        function setProvincias(provinciasList) {
            const provincias = document.getElementById("provincia");

            // Elimina las provincias anteriores
            while (provincias.firstChild) {
                provincias.removeChild(provincias.firstChild);
            }

            // Añade las nuevas provincias
            provinciasList.forEach(provincia => {
                const option = document.createElement("option");
                option.value = provincia;
                option.textContent = provincia;
                provincias.appendChild(option);
            });
        }

        function setModelosList() {
            switch (document.getElementById("marca").value) {
                case "alfa_romeo":
                    setModelos(["Giulia", "Stelvio"]);
                    break;
                case "audi":
                    setModelos(["A1", "A3", "A4", "A5", "A6", "A7", "A8", "Q2", "Q3", "Q5", "Q7", "Q8", "TT"]);
                    break;
                case "bmw":
                    setModelos(["Serie 1", "Serie 2", "Serie 3", "Serie 4", "Serie 5", "Serie 6", "Serie 7", "X1", "X2", "X3", "X4", "X5", "X6", "X7", "Z4"]);
                    break;
                case "citroen":
                    setModelos(["C1", "C3", "C4", "C5", "C6", "C8", "C-Crosser", "C-Elysée", "C-Zero", "DS3", "DS4", "DS5", "Jumper", "Jumpy", "Nemo", "Saxo", "Xantia", "XM", "Xsara", "Xsara Picasso", "ZX"]);
                    break;
                case "fiat":
                    setModelos(["500", "500L", "500X", "Bravo", "Croma", "Doblo", "Ducato", "Fiorino", "Freemont", "Fullback", "Grande Punto", "Idea", "Linea", "Marea", "Multipla", "Palio", "Panda", "Punto", "Qubo", "Scudo", "Sedici", "Seicento", "Stilo", "Talento", "Tipo", "Ulysse"]);
                    break;
                case "ford":
                    setModelos(["B-Max", "C-Max", "EcoSport", "Edge", "Escort", "Explorer", "Fiesta", "Focus", "Fusion", "Galaxy", "Ka", "Kuga", "Mondeo", "Mustang", "Puma", "Ranger", "S-Max", "Tourneo", "Transit"]);
                    break;
                case "honda":
                    setModelos(["Accord", "Civic", "CR-V", "CR-Z", "FR-V", "HR-V", "Insight", "Jazz", "Legend", "NSX", "Prelude"]);
                    break;
                case "hyundai":
                    setModelos(["Accent", "Atos", "Coupe", "Elantra", "Getz", "Grand Santa Fe", "H-1", "i10", "i20", "i30", "i40", "i800", "ix20", "ix35", "ix55", "Kona", "Matrix", "Santa Fe", "Sonata", "Terracan", "Trajet", "Tucson", "Veloster"]);
                    break;
                case "kia":
                    setModelos(["Carens", "Carnival", "Ceed", "Cerato", "Clarus", "Joice", "Magentis", "Niro", "Opirus", "Optima", "Picanto", "Pregio", "Pride", "Pro Ceed", "Rio", "Seltos", "Sephia", "Shuma", "Sorento", "Soul", "Sportage", "Stinger", "Stonic", "Venga", "Xceed"]);
                    break;
                case "mazda":
                    setModelos(["121", "2", "3", "323", "5", "6", "626", "929", "B2500", "BT-50", "CX-3", "CX-30", "CX-5", "CX-7", "CX-9", "Demio", "MPV", "MX-3", "MX-5", "MX-6", "Premacy", "RX-7", "RX-8", "Tribute", "Xedos 6", "Xedos 9"]);
                    break;
                case "mercedes":
                    setModelos(["A", "B", "C", "CL", "CLA", "CLC", "CLK", "CLS", "E", "G", "GL", "GLA", "GLB", "GLC", "GLE", "GLK", "GLS", "M", "R", "S", "SL", "SLC", "SLK", "SLR", "SLS", "V", "Vaneo", "Viano", "Vito", "X", "Z"]);
                    break;
                case "mini":
                    setModelos(["Cabrio", "Clubman", "Countryman", "Coupe", "One", "Paceman", "Roadster"]);
                    break;
                case "nissan":
                    setModelos(["350Z", "370Z", "Almera", "Cabstar", "Cube", "GT-R", "Juke", "Leaf", "Maxima", "Micra", "Murano", "Navara", "Note", "NP300", "NV200", "Pathfinder", "Patrol", "Pickup", "Pixo", "Primastar", "Primera", "Pulsar", "Qashqai", "Serena", "Sunny", "Terrano", "Tiida", "Vanette", "X-Trail"]);
                    break;
                case "opel":
                    setModelos(["Adam", "Agila", "Ampera", "Antara", "Astra", "Calibra", "Campo", "Cascada", "Combo", "Corsa", "Crossland X", "Frontera", "Grandland X", "Insignia", "Kadett", "Karl", "Manta", "Meriva", "Mokka", "Monterey", "Monza", "Movano", "Omega", "Rekord", "Senator", "Signum", "Sintra", "Speedster", "Tigra", "Vectra", "Vivaro", "Zafira"]);
                    break;
                case "peugeot":
                    setModelos(["1007", "106", "107", "108", "2008", "205", "206", "207", "208", "3008", "301", "305", "306", "307", "308", "309", "4007", "4008", "405", "406", "407", "5008", "504", "505", "508", "604", "605", "607", "806", "807", "Bipper", "Boxer", "Expert", "iOn", "Partner", "RCZ", "Rifter", "Traveller"]);
                    break;
                case "renault":
                    setModelos(["4", "5", "6", "9", "11", "12", "14", "15", "16", "17", "18", "19", "20", "21", "25", "30", "Avantime", "Captur", "Clio", "Espace", "Express", "Fluence", "Fuego", "Grand Espace", "Grand Modus", "Grand Scenic", "Kadjar", "Kangoo", "Koleos", "Laguna", "Latitude", "Mascott", "Master", "Megane", "Modus", "Safrane", "Scenic", "Sport Spider", "Super 5", "Talisman", "Thalia", "Trafic", "Twingo", "Twizy", "Vel Satis", "Wind", "Zoe"]);
                    break;
                case "seat":
                    setModelos(["Alhambra", "Altea", "Arona", "Ateca", "Cordoba", "Exeo", "Ibiza", "Leon", "Mii", "Tarraco", "Toledo"]);
                    break;
                case "skoda":
                    setModelos(["Citigo", "Fabia", "Kamiq", "Karoq", "Kodiaq", "Octavia", "Rapid", "Roomster", "Scala", "Superb", "Yeti"]);
                    break;
                case "toyota":
                    setModelos(["4Runner", "Auris", "Avensis", "Aygo", "C-HR", "Camry", "Carina", "Celica", "Corolla", "Corona", "Cressida", "Crown", "Dyna", "GT86", "Hiace", "Highlander", "Hilux", "iQ", "Land Cruiser", "MR2", "Paseo", "Picnic", "Previa", "Prius", "Proace", "RAV4", "Sequoia", "Sienna", "Starlet", "Supra", "Tercel", "Urban Cruiser", "Verso", "Yaris"]);
                    break;
                case "volkswagen":
                    setModelos(["Arteon", "Beetle", "Bora", "Caddy", "California", "Caravelle", "CC", "Corrado", "Crafter", "Eos", "Fox", "Golf", "Jetta", "Lupo", "Multivan", "Passat", "Phaeton", "Polo", "Scirocco", "Sharan", "T-Cross", "T-Roc", "Tiguan", "Touareg", "Touran", "Transporter", "Up", "Vento"]);
                    break;
                case "volvo":
                    setModelos(["240", "340", "360", "440", "460", "480", "740", "760", "780", "850", "940", "960", "C30", "C70", "S40", "S60", "S70", "S80", "S90", "V40", "V50", "V60", "V70", "V90", "XC40", "XC60", "XC70", "XC90"]);
                    break;
            }
        }

        function setDragFileEvent() {
            document.addEventListener("dragover", event => event.preventDefault());
            document.addEventListener("drop", loadDroppedFile);
        }

        function loadDroppedFile(event) {
            event.preventDefault();

            const archivo = document.getElementById("archivo");
            archivo.files = event.dataTransfer.files;
            validateArchivo();
        }

        function setModelos(modelosList) {
            const modelos = document.getElementById("modelo");

            // Elimina los modelos anteriores
            while (modelos.firstChild) {
                modelos.removeChild(modelos.firstChild);
            }

            // Añade los nuevos modelos
            modelosList.forEach(modelo => {
                const option = document.createElement("option");
                option.value = modelo;
                option.textContent = modelo;
                modelos.appendChild(option);
            });
        }

        // Utils
        function onlyWords(value) {

            // Regex para que solo se permitan letras, acentos y espacios
            const onlyWordsRegex = /^[a-zA-ZáéíóúÁÉÍÓÚñÑàèìòùÀÈÌÒÙäëïöüÄËÏÖÜâêîôûÂÊÎÔÛ\s]+$/;

            return onlyWordsRegex.test(value);
        }

        function isAdult(value) {
            const date = new Date(value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es mayor o igual a 18, es adulto
            return age >= 18;
        }

        function isPast(value) {
            const date = new Date(value);
            const now = new Date();

            // Si la fecha es anterior o igual a la actual, es válida
            return date <= now;
        }

        function checkValid(condition, input) {
            if (condition) {
                validInput(input);
                return true;
            } else {
                invalidInput(input);
                return false;
            }
        }

        function invalidInput(input) {
            if (document.getElementById("wrong_" + input.id)) {
                return;
            }

            const wrong = document.createElement("p");
            wrong.id = "wrong_" + input.id;
            wrong.textContent = '❌';
            wrong.title = invalidTitle(input);

            input.parentNode.appendChild(wrong);
        }
        
        function validInput(input) {
            try {
                const wrong = document.getElementById("wrong_" + input.id);
                wrong.remove();
            } catch (_) {}
        }

        function invalidTitle(input) {
            switch (input.id) {
                case "nombre":
                    return "El nombre solo puede contener letras, acentos y espacios";
                case "apellidos":
                    return "Los apellidos solo pueden contener letras, acentos y espacios";
                case "DNI":
                    return "El DNI debe contener 8 números seguidos de una letra";
                case "nacimiento":
                    return "La fecha de nacimiento debe corresponder a una mayoría de edad";
                case "carnet":
                    return "La fecha de expedición del carnet debe ser anterior o igual a la actual";
                case "matriculacion":
                    return "La fecha de matriculación debe ser anterior o igual a la actual";
                case "codigo_postal":
                    return "El código postal debe contener 5 números";
                case "archivo":
                    return "El archivo debe ser de tipo jpg";
                case "correo":
                    return "El correo debe contener al menos un caracter, seguido de @, seguido de al menos un caracter, seguido de .";
                case "telefono":
                    return "El teléfono debe contener 9 números";
                case "terminos":
                    return "Debes aceptar los términos y condiciones";
                case "matricula":
                    return "La matrícula debe contener 4 números seguidos de 3 letras";
            }
        }

        function isOldAdult() {
            const nacimiento = document.getElementById("nacimiento");

            const date = new Date(nacimiento.value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es mayor o igual a 25, es adulto
            return age >= 25;
        }

        function isNewDriver() {
            const carnet = document.getElementById("carnet");

            const date = new Date(carnet.value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es menor o igual a 2, es nuevo conductor
            return age <= 5;
        }

        function vehiculoTypePriceModifier(modificadorPrecio) {
            switch (document.getElementById("vehiculo").value) {
                case "diesel":
                    return modificadorPrecio + 20;
                case "gasolina":
                    return modificadorPrecio + 15;
                case "hibrido":
                    return price + 5;
                case "electrico":
                    return modificadorPrecio;
            }
        }

        function matriculacionPriceModifier(modificadorPrecio) {
            const matriculacion = document.getElementById("matriculacion");

            const date = new Date(matriculacion.value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            return age > 10 ? modificadorPrecio + (age - 10) : modificadorPrecio;
        }

        function priceCalculator(price) { 
            let modificadorPrecio = isOldAdult() ? 0 : 10;

            modificadorPrecio = isNewDriver() ? modificadorPrecio + 10 : modificadorPrecio;

            modificadorPrecio = vehiculoTypePriceModifier(modificadorPrecio);

            modificadorPrecio = matriculacionPriceModifier(modificadorPrecio);

            return ((1 + (modificadorPrecio / 100)) * price).toFixed(2);
        }

        function getSegurosList() {
            const seguroTipo = document.getElementById("seguro").value;

            return [
                {
                    name: "Seguro a terceros ",
                    price: priceCalculator(500),
                    type: "Seguro a terceros",
                    chosen: seguroTipo === "terceros",
                    id: "low"
                },
                {
                    name: "Seguro a terceros ampliado",
                    price: priceCalculator(650),
                    type: "Seguro a terceros ampliado",
                    chosen: seguroTipo === "terceros_ampliado",
                    id: "low_plus"
                },
                {
                    name: "Seguro con franquicia",
                    price: priceCalculator(750),
                    type: "Seguro con franquicia",
                    chosen: seguroTipo === "franquicia",
                    id: "medium"
                },
                {
                    name: "Seguro a todo riesgo",
                    price: priceCalculator(1000),
                    type: "Seguro a todo riesgo",
                    chosen: seguroTipo === "todo_riesgo",
                    id: "high"
                }
            ];
        }

        function contratar() {
            alert("Gracias por contratar.  Atentamente tu asesor de seguros Darío Reig Buades");

            location.reload();
        }

        function descartar(seguroId) {
            const card = document.getElementById(seguroId);

            card.style.display = "none";
        }

        // Main
        window.onload = function() {
            setEvents();
        };

        var fin = false;
        function find() {
            if (!fin) {
                const terminos = document.getElementById("terminos");

                if (everythingValid()) {
                    showOffers()
                    fin = true;
                }
            }
        }

        function showOffers() {

            const segurosList = getSegurosList();

            var cards = document.createElement("div");
            cards.classList.add("cards");

            segurosList.forEach ( function (seguro) {
                    var card = document.createElement("div");
                    card.id = seguro.id;
                    card.classList.add("card");
                    card.innerHTML = "<h2>" + seguro.name + "</h2>";
                    card.innerHTML += "<h3>" + seguro.price + "€</h3>";
                    card.innerHTML += "<p>" + seguro.type + "</p>";
                    
                    if (seguro.chosen) {
                        card.style.backgroundColor = "green";
                    }
                    
                    var contratarButton = document.createElement("button");
                    contratarButton.textContent = "Contratar";
                    contratarButton.onclick = function () { 
                        contratar() 
                    };
                    contratarButton.addEventListener("mouseover", function() {
                        contratarButton.style.backgroundColor = "yellow";
                        contratarButton.style.transform = "scale(1.1)";
                    });
                    contratarButton.addEventListener("mouseout", function() {
                        contratarButton.style.backgroundColor = "blue";
                        contratarButton.style.transform = "scale(1)";
                    });

                    var descartarButton = document.createElement("button");
                    descartarButton.textContent = "Descartar";
                    descartarButton.onclick = function() {
                        descartar(seguro.id) 
                    };

                    card.appendChild(contratarButton);
                    card.appendChild(descartarButton);
                    cards.appendChild(card); 
                }
            )
            
            document.getElementById("main").appendChild(cards);
        }

        function everythingValid() {
            return (
                validateNombre() &&
                validateApellidos() &&
                validateDNI() &&
                validateCorreo() &&
                validateTelefono() &&
                validateCodigoPostal() &&
                validateCarnet() &&
                validateMatriculacion() &&
                validateMatricula() &&
                validateNacimiento() &&
                validateMatricula() &&
                validateArchivo() &&
                validateTerminos()
            )
        }


    </script>
</body>
</html>