<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad aseguradora</title>
    <style>
        form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 10px;
        }

        div {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .wrong {
            display: none;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <form>
        <div id="nombre_div">
            <label for="nombre">Nombre</label>

            <!-- Limita el campo a 30 caracteres -->
            <input id="nombre" type="text"  placeholder="Nombre" maxlength="30">
        </div>
            
        <div id="apellidos_div">
            <label for="apellidos">Apellidos</label>
            <input id="apellidos" type="text" placeholder="Apellidos">
        </div>

        <div id="DNI_div">
            <label for="DNI">DNI</label>
            <input id="DNI" type="text" placeholder="01234567X">
        </div>

        <div id="correo_div">
            <label for="correo">Correo electrónico</label>
            <input id="correo" type="text" placeholder="abc@def.com">
        </div>

        <div id="telefono_div">
            <label for="telefono">Teléfono</label>
            <input id="telefono" type="number" placeholder="123456789">
        </div>

        <div id="codigo_postal_div">
            <label for="codigo_postal">Código postal</label>
            <input id="codigo_postal" type="number" placeholder="12345">
        </div>

        <div id="carnet_div">
            <label for="carnet">Fecha de expedición del carnet de conducir</label>
            <input id="carnet" type="date">
        </div>

        <div id="matriculacion_div">
            <label for="matriculacion">Fecha de matriculación</label>
            <input id="matriculacion" type="date">
        </div>

        <div id="nacimiento_div">
            <label for="nacimiento">Fecha de nacimiento</label>
            <input id="nacimiento" type="date">
        </div>

        <div id="sexo_div">
            <label for="sexo">Sexo</label>
            <select id="sexo">
                <option value="hombre">Hombre</option>
                <option value="mujer">Mujer</option>
                <option value="otro">Otro</option>
            </select>
        </div>

        <div id="comunidad_provincia_div">
            <label for="comunidad">Comunidad autónoma</label>
            <select id="comunidad">
                <option value="andalucia">Andalucía</option>
                <option value="aragon">Aragón</option>
                <option value="asturias">Asturias</option>
                <option value="baleares">Baleares</option>
                <option value="canarias">Canarias</option>
                <option value="cantabria">Cantabria</option>
                <option value="castilla_la_mancha">Castilla-La Mancha</option>
                <option value="castilla_y_leon">Castilla y León</option>
                <option value="cataluña">Cataluña</option>
                <option value="comunidad_valenciana">Comunidad Valenciana</option>
                <option value="extremadura">Extremadura</option>
                <option value="galicia">Galicia</option>
                <option value="madrid">Madrid</option>
                <option value="murcia">Murcia</option>
                <option value="navarra">Navarra</option>
                <option value="pais_vasco">País Vasco</option>
                <option value="la_rioja">La Rioja</option>
                <option value="ceuta">Ceuta</option>
                <option value="melilla">Melilla</option>
            </select>
            
            <label for="provincia">Provincia</label>
            <select id="provincia"></select>
        </div>

        <div id="marca_modelo_div">
            <label for="marca">Marca</label>
            <select id="marca">
                <option value="alfa_romeo">Alfa Romeo</option>
                <option value="audi">Audi</option>
                <option value="bmw">BMW</option>
                <option value="citroen">Citroën</option>
                <option value="fiat">Fiat</option>
                <option value="ford">Ford</option>
                <option value="honda">Honda</option>
                <option value="hyundai">Hyundai</option>
                <option value="kia">Kia</option>
                <option value="mazda">Mazda</option>
                <option value="mercedes">Mercedes</option>
                <option value="mini">Mini</option>
                <option value="nissan">Nissan</option>
                <option value="opel">Opel</option>
                <option value="peugeot">Peugeot</option>
                <option value="renault">Renault</option>
                <option value="seat">Seat</option>
                <option value="skoda">Skoda</option>
                <option value="toyota">Toyota</option>
                <option value="volkswagen">Volkswagen</option>
                <option value="volvo">Volvo</option>
            </select>
            <label for="modelo">Modelo</label>
            <select id="modelo"></select>
            <label for="seguro">Tipo de seguro</label>
            <select id="seguro">
                <option value="terceros">Terceros</option>
                <option value="terceros_ampliado">Terceros ampliado</option>
                <option value="franquicia">Con franquicia</option>
                <option value="todo_riesgo">Todo riesgo</option>
            </select>
        </div>
        
        <div id="vehiculo_div">
            <label for="vehiculo">Tipo de vehículo</label>
            <select id="vehiculo">
                <option value="diesel">Diesel</option>
                <option value="gasolina">Gasolina</option>
                <option value="hibrido">Híbrido</option>
                <option value="electrico">Eléctrico</option>
            </select>
        </div>

        <div id="archivo_div">
            <label for="archivo">Subir archivo (jpg/jpeg/png)</label>

            <!-- Limita el tipo de archivo a jpg -->
            <input id="archivo" type="file" accept=".jpg .jpeg .png">
        </div>

        <div id="terminos_div">
            <label for="terminos">Acepto los términos y condiciones</label>
            <input id="terminos" type="checkbox">
        </div>

        <button type="button" onclick="find();">Encontrar seguro</button>
    </form>

    <script>
        // Validators
        function validateNombre() {
            const nombre = document.getElementById("nombre");
            if (nombre.value.length < 30) {
                checkValid(onlyWords(nombre.value), nombre);
            } else {
                invalidInput(nombre);
            }
        }

        function validateApellidos() {
            const apellidos = document.getElementById("apellidos");

            checkValid(onlyWords(apellidos.value), apellidos);
        }

        function validateDNI() {
            const DNI = document.getElementById("DNI");

            // Regex permite 8 números seguidos de una letra
            const DNIRegex = /^[0-9]{8}[a-zA-Z]$/;

            checkValid(DNIRegex.test(DNI.value), DNI);
        }
           
        function validateNacimiento() {
            const nacimiento = document.getElementById("nacimiento");

            checkValid(isAdult(nacimiento.value), nacimiento);
        }

        function validateCarnet() {
            const carnet = document.getElementById("carnet");

            checkValid(isPast(carnet.value), carnet);
        }

        function validateMatriculacion() {
            const matriculacion = document.getElementById("matriculacion");

            checkValid(isPast(matriculacion.value), matriculacion);
        }

        function validateMatricula() {
            const matricula = document.getElementById("matricula");

            // Regex permite 4 números seguidos de 3 letras
            const matriculaRegex = /^[0-9]{4}[a-zA-Z]{3}$/;

            checkValid(matriculaRegex.test(matricula.value), matricula);
        }

        function validateCodigoPostal() {
            const codigoPostal = document.getElementById("codigo_postal");

            // Regex permite 5 números
            const codigoPostalRegex = /^[0-9]{5}$/;

            checkValid(codigoPostalRegex.test(codigoPostal.value), codigoPostal);
        }

        function validateArchivo() {
            const archivo = document.getElementById("archivo");

            // Comprueba que el archivo sea de tipo jpg
            checkValid(archivo.value.endsWith(".jpg"), archivo);
        }

        function validateCorreo() {
            const correo = document.getElementById("correo");

            // Regex permite cualquier caracter seguido de @ seguido de cualquier caracter seguido de .
            const correoRegex = /.+@.+\..+/;

            checkValid(correoRegex.test(correo.value), correo);
        }

        function validateTelefono() {
            const telefono = document.getElementById("telefono");

            // Regex permite 9 números
            const telefonoRegex = /^[0-9]{9}$/;

            checkValid(telefonoRegex.test(telefono.value), telefono);
        }

        // Main
        window.onload = function() {
            setProvinciasList();
            setEvents();
        };

        // Event setters
        function setEvents() {
            setValidators();
            setProvinciasList();
            setModelosList();

            document.getElementById("comunidad").addEventListener("change", setProvinciasList);
            document.getElementById("marca").addEventListener("change", setModelosList);
            
            setDragFileEvent();
        }

        function setValidators() {
            document.getElementById("nombre").addEventListener("blur", validateNombre);
            document.getElementById("apellidos").addEventListener("blur", validateApellidos);
            document.getElementById("DNI").addEventListener("blur", validateDNI);
            document.getElementById("nacimiento").addEventListener("input", validateNacimiento);
            document.getElementById("carnet").addEventListener("input", validateCarnet);
            document.getElementById("matriculacion").addEventListener("input", validateMatriculacion);
            document.getElementById("codigo_postal").addEventListener("blur", validateCodigoPostal);
            document.getElementById("archivo").addEventListener("change", validateArchivo);

            // Validaciones extra
            document.getElementById("correo").addEventListener("blur", validateCorreo);
            document.getElementById("telefono").addEventListener("blur", validateTelefono);
        }

        function setProvinciasList() {
            switch (document.getElementById("comunidad").value) {
                case "andalucia":
                    setProvincias(["Almería", "Cádiz", "Córdoba", "Granada", "Huelva", "Jaén", "Málaga", "Sevilla"]);
                    break;
                case "aragon":
                    setProvincias(["Huesca", "Teruel", "Zaragoza"]);
                    break;
                case "asturias":
                    setProvincias(["Asturias"]);
                    break;
                case "baleares":
                    setProvincias(["Baleares"]);
                    break;
                case "canarias":
                    setProvincias(["Las Palmas", "Santa Cruz de Tenerife"]);
                    break;
                case "cantabria":
                    setProvincias(["Cantabria"]);
                    break;
                case "castilla_la_mancha":
                    setProvincias(["Albacete", "Ciudad Real", "Cuenca", "Guadalajara", "Toledo"]);
                    break;
                case "castilla_y_leon":
                    setProvincias(["Ávila", "Burgos", "León", "Palencia", "Salamanca", "Segovia", "Soria", "Valladolid", "Zamora"]);
                    break;
                case "cataluña":
                    setProvincias(["Barcelona", "Girona", "Lleida", "Tarragona"]);
                    break;
                case "comunidad_valenciana":
                    setProvincias(["Alicante", "Castellón", "Valencia"]);
                    break;
                case "extremadura":
                    setProvincias(["Badajoz", "Cáceres"]);
                    break;
                case "galicia":
                    setProvincias(["A Coruña", "Lugo", "Ourense", "Pontevedra"]);
                    break;
                case "madrid":
                    setProvincias(["Madrid"]);
                    break;
                case "murcia":
                    setProvincias(["Murcia"]);
                    break;
                case "navarra":
                    setProvincias(["Navarra"]);
                    break;
                case "pais_vasco":
                    setProvincias(["Álava", "Gipuzkoa", "Bizkaia"]);
                    break;
                case "la_rioja":
                    setProvincias(["La Rioja"]);
                    break;
            }
        }

        function setProvincias(provinciasList) {
            const provincias = document.getElementById("provincia");

            // Elimina las provincias anteriores
            while (provincias.firstChild) {
                provincias.removeChild(provincias.firstChild);
            }

            // Añade las nuevas provincias
            provinciasList.forEach(provincia => {
                const option = document.createElement("option");
                option.value = provincia;
                option.textContent = provincia;
                provincias.appendChild(option);
            });
        }

        function setModelosList() {
            switch (document.getElementById("marca").value) {
                case "alfa_romeo":
                    setModelos(["Giulia", "Stelvio"]);
                    break;
                case "audi":
                    setModelos(["A1", "A3", "A4", "A5", "A6", "A7", "A8", "Q2", "Q3", "Q5", "Q7", "Q8", "TT"]);
                    break;
                case "bmw":
                    setModelos(["Serie 1", "Serie 2", "Serie 3", "Serie 4", "Serie 5", "Serie 6", "Serie 7", "X1", "X2", "X3", "X4", "X5", "X6", "X7", "Z4"]);
                    break;
                case "citroen":
                    setModelos(["C1", "C3", "C4", "C5", "C6", "C8", "C-Crosser", "C-Elysée", "C-Zero", "DS3", "DS4", "DS5", "Jumper", "Jumpy", "Nemo", "Saxo", "Xantia", "XM", "Xsara", "Xsara Picasso", "ZX"]);
                    break;
                case "fiat":
                    setModelos(["500", "500L", "500X", "Bravo", "Croma", "Doblo", "Ducato", "Fiorino", "Freemont", "Fullback", "Grande Punto", "Idea", "Linea", "Marea", "Multipla", "Palio", "Panda", "Punto", "Qubo", "Scudo", "Sedici", "Seicento", "Stilo", "Talento", "Tipo", "Ulysse"]);
                    break;
                case "ford":
                    setModelos(["B-Max", "C-Max", "EcoSport", "Edge", "Escort", "Explorer", "Fiesta", "Focus", "Fusion", "Galaxy", "Ka", "Kuga", "Mondeo", "Mustang", "Puma", "Ranger", "S-Max", "Tourneo", "Transit"]);
                    break;
                case "honda":
                    setModelos(["Accord", "Civic", "CR-V", "CR-Z", "FR-V", "HR-V", "Insight", "Jazz", "Legend", "NSX", "Prelude"]);
                    break;
                case "hyundai":
                    setModelos(["Accent", "Atos", "Coupe", "Elantra", "Getz", "Grand Santa Fe", "H-1", "i10", "i20", "i30", "i40", "i800", "ix20", "ix35", "ix55", "Kona", "Matrix", "Santa Fe", "Sonata", "Terracan", "Trajet", "Tucson", "Veloster"]);
                    break;
                case "kia":
                    setModelos(["Carens", "Carnival", "Ceed", "Cerato", "Clarus", "Joice", "Magentis", "Niro", "Opirus", "Optima", "Picanto", "Pregio", "Pride", "Pro Ceed", "Rio", "Seltos", "Sephia", "Shuma", "Sorento", "Soul", "Sportage", "Stinger", "Stonic", "Venga", "Xceed"]);
                    break;
                case "mazda":
                    setModelos(["121", "2", "3", "323", "5", "6", "626", "929", "B2500", "BT-50", "CX-3", "CX-30", "CX-5", "CX-7", "CX-9", "Demio", "MPV", "MX-3", "MX-5", "MX-6", "Premacy", "RX-7", "RX-8", "Tribute", "Xedos 6", "Xedos 9"]);
                    break;
                case "mercedes":
                    setModelos(["A", "B", "C", "CL", "CLA", "CLC", "CLK", "CLS", "E", "G", "GL", "GLA", "GLB", "GLC", "GLE", "GLK", "GLS", "M", "R", "S", "SL", "SLC", "SLK", "SLR", "SLS", "V", "Vaneo", "Viano", "Vito", "X", "Z"]);
                    break;
                case "mini":
                    setModelos(["Cabrio", "Clubman", "Countryman", "Coupe", "One", "Paceman", "Roadster"]);
                    break;
                case "nissan":
                    setModelos(["350Z", "370Z", "Almera", "Cabstar", "Cube", "GT-R", "Juke", "Leaf", "Maxima", "Micra", "Murano", "Navara", "Note", "NP300", "NV200", "Pathfinder", "Patrol", "Pickup", "Pixo", "Primastar", "Primera", "Pulsar", "Qashqai", "Serena", "Sunny", "Terrano", "Tiida", "Vanette", "X-Trail"]);
                    break;
                case "opel":
                    setModelos(["Adam", "Agila", "Ampera", "Antara", "Astra", "Calibra", "Campo", "Cascada", "Combo", "Corsa", "Crossland X", "Frontera", "Grandland X", "Insignia", "Kadett", "Karl", "Manta", "Meriva", "Mokka", "Monterey", "Monza", "Movano", "Omega", "Rekord", "Senator", "Signum", "Sintra", "Speedster", "Tigra", "Vectra", "Vivaro", "Zafira"]);
                    break;
                case "peugeot":
                    setModelos(["1007", "106", "107", "108", "2008", "205", "206", "207", "208", "3008", "301", "305", "306", "307", "308", "309", "4007", "4008", "405", "406", "407", "5008", "504", "505", "508", "604", "605", "607", "806", "807", "Bipper", "Boxer", "Expert", "iOn", "Partner", "RCZ", "Rifter", "Traveller"]);
                    break;
                case "renault":
                    setModelos(["4", "5", "6", "9", "11", "12", "14", "15", "16", "17", "18", "19", "20", "21", "25", "30", "Avantime", "Captur", "Clio", "Espace", "Express", "Fluence", "Fuego", "Grand Espace", "Grand Modus", "Grand Scenic", "Kadjar", "Kangoo", "Koleos", "Laguna", "Latitude", "Mascott", "Master", "Megane", "Modus", "Safrane", "Scenic", "Sport Spider", "Super 5", "Talisman", "Thalia", "Trafic", "Twingo", "Twizy", "Vel Satis", "Wind", "Zoe"]);
                    break;
                case "seat":
                    setModelos(["Alhambra", "Altea", "Arona", "Ateca", "Cordoba", "Exeo", "Ibiza", "Leon", "Mii", "Tarraco", "Toledo"]);
                    break;
                case "skoda":
                    setModelos(["Citigo", "Fabia", "Kamiq", "Karoq", "Kodiaq", "Octavia", "Rapid", "Roomster", "Scala", "Superb", "Yeti"]);
                    break;
                case "toyota":
                    setModelos(["4Runner", "Auris", "Avensis", "Aygo", "C-HR", "Camry", "Carina", "Celica", "Corolla", "Corona", "Cressida", "Crown", "Dyna", "GT86", "Hiace", "Highlander", "Hilux", "iQ", "Land Cruiser", "MR2", "Paseo", "Picnic", "Previa", "Prius", "Proace", "RAV4", "Sequoia", "Sienna", "Starlet", "Supra", "Tercel", "Urban Cruiser", "Verso", "Yaris"]);
                    break;
                case "volkswagen":
                    setModelos(["Arteon", "Beetle", "Bora", "Caddy", "California", "Caravelle", "CC", "Corrado", "Crafter", "Eos", "Fox", "Golf", "Jetta", "Lupo", "Multivan", "Passat", "Phaeton", "Polo", "Scirocco", "Sharan", "T-Cross", "T-Roc", "Tiguan", "Touareg", "Touran", "Transporter", "Up", "Vento"]);
                    break;
                case "volvo":
                    setModelos(["240", "340", "360", "440", "460", "480", "740", "760", "780", "850", "940", "960", "C30", "C70", "S40", "S60", "S70", "S80", "S90", "V40", "V50", "V60", "V70", "V90", "XC40", "XC60", "XC70", "XC90"]);
                    break;
            }
        }

        function setDragFileEvent() {
            document.addEventListener("dragover", event => event.preventDefault());
            document.addEventListener("drop", loadDroppedFile);
        }

        function loadDroppedFile(event) {
            event.preventDefault();

            const archivo = document.getElementById("archivo");
            archivo.files = event.dataTransfer.files;
            validateArchivo();
        }

        function setModelos(modelosList) {
            const modelos = document.getElementById("modelo");

            // Elimina los modelos anteriores
            while (modelos.firstChild) {
                modelos.removeChild(modelos.firstChild);
            }

            // Añade los nuevos modelos
            modelosList.forEach(modelo => {
                const option = document.createElement("option");
                option.value = modelo;
                option.textContent = modelo;
                modelos.appendChild(option);
            });
        }

        // Utils
        function onlyWords(value) {

            // Regex para que solo se permitan letras, acentos y espacios
            const onlyWordsRegex = /^[a-zA-ZáéíóúÁÉÍÓÚñÑàèìòùÀÈÌÒÙäëïöüÄËÏÖÜâêîôûÂÊÎÔÛ\s]+$/;

            return onlyWordsRegex.test(value);
        }

        function isAdult(value) {
            const date = new Date(value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es mayor o igual a 18, es adulto
            return age >= 18;
        }

        function isPast(value) {
            const date = new Date(value);
            const now = new Date();

            // Si la fecha es anterior a la actual, es válida
            return date < now;
        }

        function checkValid(condition, input) {
            if (condition) {
                validInput(input);
            } else {
                invalidInput(input);
            }
        }

        function invalidInput(input) {
            if (document.getElementById("wrong_" + input.id)) {
                return;
            }

            const wrong = document.createElement("p");
            wrong.id = "wrong_" + input.id;
            wrong.textContent = '❌';
            wrong.title = invalidTitle(input);

            // TODO: Añadir mensaje de error al icono
            input.parentNode.appendChild(wrong);
        }
        
        function validInput(input) {
            try {
                const wrong = document.getElementById("wrong_" + input.id);
                wrong.remove();
            } catch (_) {}
        }

        function invalidTitle(input) {
            switch (input.id) {
                case "nombre":
                    return "El nombre solo puede contener letras, acentos y espacios";
                case "apellidos":
                    return "Los apellidos solo pueden contener letras, acentos y espacios";
                case "DNI":
                    return "El DNI debe contener 8 números seguidos de una letra";
                case "nacimiento":
                    return "La fecha de nacimiento debe ser anterior a la actual";
                case "carnet":
                    return "La fecha de expedición del carnet debe ser anterior a la actual";
                case "matriculacion":
                    return "La fecha de matriculación debe ser anterior a la actual";
                case "codigo_postal":
                    return "El código postal debe contener 5 números";
                case "archivo":
                    return "El archivo debe ser de tipo jpg";
                case "correo":
                    return "El correo debe contener al menos un caracter, seguido de @, seguido de al menos un caracter, seguido de .";
                case "telefono":
                    return "El teléfono debe contener 9 números";
            }
        }

        function calculateBasePrice() {
            switch (document.getElementById("seguro").value) {
                case "terceros":
                    return 500;
                case "terceros_ampliado":
                    return 650;
                case "franquicia":
                    return 750;
                case "todo_riesgo":
                    return 1000;
            };
        }

        function isOldAdult() {
            const nacimiento = document.getElementById("nacimiento");

            const date = new Date(nacimiento.value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es mayor o igual a 25, es adulto
            return age >= 25;
        }

        function isNewDriver() {
            const carnet = document.getElementById("carnet");

            const date = new Date(carnet.value);
            const now = new Date();

            // Convierte el resultado a años
            const age = (now - date) / (1000 * 60 * 60 * 24 * 365.25);

            // Si la edad es menor o igual a 2, es nuevo conductor
            return age <= 5;
        }

        function vehiculoTypePriceModifier(price) {
            switch (document.getElementById("vehiculo").value) {
                case "diesel":
                    return price * 1.2;
                case "gasolina":
                    return price * 1.15;
                case "hibrido":
                    return price * 1.05;
                case "electrico":
                    return price;
            }
        }

        function priceCalculator() { 
            const price = calculateBasePrice();       
            
            price = isOldAdult() ? price : price * 1.1;

            price = isNewDriver() ? price * 1.1 : price;

            price = vehiculoTypePriceModifier(price);
        }
    </script>
</body>
</html>